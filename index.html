<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>iTimeTraveler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta name="description" content="Someone knock at the door.">
<meta property="og:type" content="website">
<meta property="og:title" content="iTimeTraveler">
<meta property="og:url" content="http://github.com/index.html">
<meta property="og:site_name" content="iTimeTraveler">
<meta property="og:description" content="Someone knock at the door.">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iTimeTraveler">
<meta name="twitter:description" content="Someone knock at the door.">
  
    <link rel="alternate" href="/atom.xml" title="iTimeTraveler" type="application/atom+xml">
  

  

  <link rel="icon" href="/gallery/avatar/0.jpg">
  <link rel="apple-touch-icon" href="/gallery/avatar/0.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="css/style.css">

  <script src="js/jquery-3.1.1.min.js"></script>
  <script src="js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/home.css" >
  

  

  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

</head>



  <body>


  
    <header id="header">

	<!-- 背景图模式 -->
	

    
      <div id="intrologo" class="intro-logo" style="background-position:center; background-repeat:no-repeat; background-image: url(); background-size: auto 100%;">

      <!-- Support rolling -->  
        
        <section class="awSlider">
          <div class="carousel slide carousel-fade " data-ride="carousel">

            <!-- Wrapper for slides -->
            <div class="carousel-inner">
               
                  
                    <div class="item active">
                  
                    <img id="carousel-img0" src="https://source.unsplash.com/collection/954550/1920x1080">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img0 = new Image();
                      var imageTag0 = document.getElementById("carousel-img0");
                      img0.src = imageTag0.src;
                      img0.onload=function(){
                        if (img0.width / img0.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag0.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag0.style.height = document.body.clientHeight + "px";
                          imageTag0.style.marginLeft = -(document.body.clientHeight * img0.width / img0.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img1" src="https://source.unsplash.com/collection/954550/1920x1081">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img1 = new Image();
                      var imageTag1 = document.getElementById("carousel-img1");
                      img1.src = imageTag1.src;
                      img1.onload=function(){
                        if (img1.width / img1.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag1.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag1.style.height = document.body.clientHeight + "px";
                          imageTag1.style.marginLeft = -(document.body.clientHeight * img1.width / img1.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img2" src="https://source.unsplash.com/collection/954550/1921x1080">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img2 = new Image();
                      var imageTag2 = document.getElementById("carousel-img2");
                      img2.src = imageTag2.src;
                      img2.onload=function(){
                        if (img2.width / img2.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag2.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag2.style.height = document.body.clientHeight + "px";
                          imageTag2.style.marginLeft = -(document.body.clientHeight * img2.width / img2.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img3" src="https://source.unsplash.com/collection/954550/1921x1081">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img3 = new Image();
                      var imageTag3 = document.getElementById("carousel-img3");
                      img3.src = imageTag3.src;
                      img3.onload=function(){
                        if (img3.width / img3.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag3.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag3.style.height = document.body.clientHeight + "px";
                          imageTag3.style.marginLeft = -(document.body.clientHeight * img3.width / img3.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img4" src="https://source.unsplash.com/collection/954550/1920x1082">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img4 = new Image();
                      var imageTag4 = document.getElementById("carousel-img4");
                      img4.src = imageTag4.src;
                      img4.onload=function(){
                        if (img4.width / img4.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag4.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag4.style.height = document.body.clientHeight + "px";
                          imageTag4.style.marginLeft = -(document.body.clientHeight * img4.width / img4.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img5" src="https://source.unsplash.com/collection/954550/1922x1080">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img5 = new Image();
                      var imageTag5 = document.getElementById("carousel-img5");
                      img5.src = imageTag5.src;
                      img5.onload=function(){
                        if (img5.width / img5.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag5.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag5.style.height = document.body.clientHeight + "px";
                          imageTag5.style.marginLeft = -(document.body.clientHeight * img5.width / img5.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img6" src="https://source.unsplash.com/collection/954550/1922x1082">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img6 = new Image();
                      var imageTag6 = document.getElementById("carousel-img6");
                      img6.src = imageTag6.src;
                      img6.onload=function(){
                        if (img6.width / img6.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag6.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag6.style.height = document.body.clientHeight + "px";
                          imageTag6.style.marginLeft = -(document.body.clientHeight * img6.width / img6.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href=".carousel" role="button" data-slide="prev">
              <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
              <span class="sr-only">Geri</span>
            </a>
            <a class="right carousel-control" href=".carousel" role="button" data-slide="next">
              <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
              <span class="sr-only">İleri</span>
            </a>
          </div>
        </section>
        <script>
          $('section.awSlider .carousel').carousel({
              pause: '',
              interval: 5000
          });
          var startImage = $('section.awSlider .item.active > img').attr('src');
          $('section.awSlider .carousel').on('slid.bs.carousel', function () {
              var bscn = $(this).find('.item.active > img').attr('src');
              $('section.awSlider > img').attr('src', bscn);
          });
        </script>
      

    
 


    <canvas width="100%" height="100%"></canvas>
    <script>
      var c = document.getElementsByTagName('canvas')[0],
          x = c.getContext('2d'),
          w = window.innerWidth,
          h = window.innerHeight,
          pr = window.devicePixelRatio || 1,
          f = 90,
          q,
          m = Math,
          r = 0,
          u = m.PI*2,
          v = m.cos,
          z = m.random
      c.width = w*pr
      c.height = h*pr
      x.scale(pr, pr)
      x.globalAlpha = 0.6

      <!-- 折线Polyline背景 -->
      
    </script>
    

    
      <div id="homelogo" class="homelogo" style="background: rgba(255,255,255,1);"> 
    

        
          <div class="homelogoback"  style="border: 1px solid #404040;" >
            <h1><a href="#content" id="logo">iTimeTraveler</a></h1>
            <h3>Someone knock at the door.</h3>
            <h5>Mr.Seven</h5>
            <!-- <p><a href="https://github.com/iTimeTraveler" target="_blank">Github</a></p> -->
          </div>
        
    
    </div>
  </div>

  <!-- 自适应主页背景大图 -->
  

 <!-- home_logo_image居中 -->
 
    <script>
        var homelogodiv = document.getElementById("homelogo");
        if (document.all.homelogo.offsetWidth > document.body.clientWidth) {
          homelogodiv.style.width = document.body.clientWidth + "px";
          homelogodiv.style.marginLeft = document.body.clientWidth * -0.5 + "px";
        } else {
          homelogodiv.style.width = homelogodiv.clientWidth  + "px";
          homelogodiv.style.marginLeft = (homelogodiv.clientWidth)  * -0.5 + "px";
        }
    </script>
  

  <div class="intro-navigate">
      <p class="navigater-list">
        
          <a id="beautifont" class="main-nav-link" href="index.html">首页</a>
        
          <a id="beautifont" class="main-nav-link" href="archives">归档</a>
        
          <a id="beautifont" class="main-nav-link" href="categories">分类</a>
        
          <a id="beautifont" class="main-nav-link" href="tags">标签</a>
        
          <a id="beautifont" class="main-nav-link" href="funnysite">酷站</a>
        
          <a id="beautifont" class="main-nav-link" href="collection">收藏</a>
        
          <a id="beautifont" class="main-nav-link" href="about">关于</a>
        
          <a id="beautifont" class="main-nav-link" href="/mybooks">🎁</a>
        
      </p>
  </div>

</header>
  
  <div id="container">
    <div id="wrap">
      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;">
  
    <article id="post-IPv6安全浅析"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2019/03/13/IPv6安全浅析/">IPv6安全浅析</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2019/03/13/IPv6安全浅析/" class="article-date">
	  <time datetime="2019-03-13T03:51:55.000Z" itemprop="datePublished">2019-03-13</time>
	</a>

      
    <a class="article-category-link" href="categories/IPv6/">IPv6</a>

      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>原文链接 ：<a href="https://www.huawei.com/ilink/en/download/HW_079734" target="_blank" rel="noopener">IPv6安全浅析 - Huawei - 2010.12 第52期</a> </p>
</blockquote>
<p>“缺乏安全性是互联网天生的弱点，这与是否采用IPv6关系不大。事实上，IPv6并没有引入新的安全问<br>题，反而由于IPSec的引入以及发送设备采用永久性IP地址而解决了网络层溯源难题，给网络安全提供了<br>根本的解决途径，有望实现端到端安全性。”中国电信科技委主任韦乐平这样评价IPv6安全。</p>
<h2 id="IPv6协议设计的安全考虑"><a href="#IPv6协议设计的安全考虑" class="headerlink" title="IPv6协议设计的安全考虑"></a>IPv6协议设计的安全考虑</h2><p>从协议的角度，IPv6作为IPv4的下一代，与IPv4同属于网络层的传输协议。然而，协议上最核心、最本质的差别就是地址空间的扩大，由IPv4下的32位地址空间变为128位的地址空间，这正是IPv6被选作新网络的承载协议并逐渐商用部署的根本驱动力。IPv6拥有如此巨大的地址空间，甚至可以为每一粒沙子都分配一个IP地址。而IPv4网络的地址分配是不规则的，并且很多时候是一个地址被多台主机共用。使用IPv6之后，我们能够将每个地址指定给一个责任体，就像给每个人一个身份证号，每辆车一个车牌号一样，每个地址都是唯一的；IPv6的地址分配采用逐级、层次化的结构，这就使得追踪定位、攻击溯源有了很大的改善。</p>
<p>另外，IPv6提出了新的地址生成方式——密码生成地址。密码生成地址与公私钥对绑定，保证地址不能被他人伪造。这如同汽车的车牌印上了指纹，别人不可能伪造这样的车牌，因为指纹造不了假。在IPv6协议设计之初，IP Sec（IPSecurity）协议族中的AH（AuthenticationHeader，报文认证头）和ESP（EncapsulationSecurity Payload，报文封装安全载荷）就内嵌到协议栈中，作为IPv6的扩展头出现在IP报文中，提供完整性、保密性和源认保护，这无疑是从协议上较大地提升安全性。</p>
<p>整体上看，IPv4协议的设计没有任何的安全考虑，特别是报文地址的伪造与欺骗使得无法对网络进行有效的监管和控制。因此，当出现网络攻击与安全威胁时，我们只能围绕攻击事件做好事前、事中和事后的防范、检测和过滤防御，缺乏有效的技术支撑手段，无法对攻击者形成真正的打击和管控。</p>
<p>而在IPv6网络的安全体系下，用户、报文和攻击可以一一对应，用户对自己的任何行为都必须负责，具有不可否认性，所以IPv6建立起严密的围绕攻击者的管控机制，实现对用户行为的安全监控。</p>
<h2 id="IPv6能减缓现有攻击"><a href="#IPv6能减缓现有攻击" class="headerlink" title="IPv6能减缓现有攻击"></a>IPv6能减缓现有攻击</h2><p>扫描几乎是任何攻击手段的必需前提。攻击者利用扫描收集目标网络的数据，据此分析、推断目标网络的拓扑结构、开放的服务、知名端口等有用信息，以作为真正攻击的基础。扫描的主要目的是通过ping每个地址，找到作为潜在攻击目标的在线主机或设备。</p>
<p>在IPv6时代，每个地址为128位，协议中规定的默认网络前缀为64位。换句话说，就是一个网段内有264个地址，假设攻击者以10M/s的速度来扫描，也得需要大约5万年的时间才能遍历。IPv6大大增大了扫描难度，由此增加了网络攻击的成本和代价。此时，黑客如果想侵占一定数量的主机发起DDoS（Distributed Denial of Service，分布式拒绝服务）攻击，那么其将会付出更多的代价，这在一定程度上减少了DDoS攻击发生的可能性。</p>
<p>IPv6协议定义了多播地址类型，而取消了IPv4下的广播地址，有效避免IPv4网络中的利用广播地址发起的广播风暴攻击和DDoS攻击。同时，IPv6协议规定了不允许向使用多播地址的报文回复ICMPv6（Internet Control Management Protocol Version6）差错消息，因此也能防止ICMPv6报文造成的放大攻击。</p>
<p>IPv6下的密码生成地址是新的地址生成方式，将公私钥对中的公钥与IPv6地址进行绑定。使用此类地址，能够保证报文的源地址不被他人伪造。在这样的安全机制保护下，在网络中传输的每一个报文均对应于一台主机，如果发生任何的攻击或者违法犯罪行为，都能够根据攻击报文追踪到发出此报文的主机，进而追查到攻击者。这种可靠的追踪溯源机制，使得黑客和攻击者容易被发现，这样就减少了网络攻击发生的可能。</p>
<h2 id="IPv6面临的新威胁"><a href="#IPv6面临的新威胁" class="headerlink" title="IPv6面临的新威胁"></a>IPv6面临的新威胁</h2><p>IPv6协议对IPv4协议的根本改变是发生在IP层，因此针对IPv6协议所定义的包<br>头及扩展头的、容易发生的安全威胁，我们需要进行充分的准备。常见的针对IPv6扩展头的攻击，主要包括利用分片扩展头发起分片攻击，逃避防火墙/IDS（Intrusion Detection System，入侵检测系统）的检查或者发动DDoS攻击；利用路由扩展头的type 0类型，在网络中发起放大攻击。</p>
<p>在IPv4向IPv6的演进过程中，我们还需要考虑各种过渡技术与方案的安全隐患。由于在共存时期，IPv4网络与IPv6网络同时存在，且有互通需求，这就要求来自两种不同IP协议网络的威胁不能够交叉感染。另外，运营商所选择部署的各种过渡技术，由于尚无成熟的使用经验，因此很可能存在潜在的安全风险。</p>
<p>具体来看，隧道技术是对报文进行一层封装。隧道报文在经过网络安全设备时，如果需要被检查与过滤，那网络安全技术就得支持各种新的隧道协议，能够对隧道进行解封装，而后才能对内嵌报文进行处理。在建立各种隧道的时候，对隧道节点的认证是十分必要的。否则，所建立的隧道是不可靠的，隧道就会被黑客和攻击者利用，成为进<br>入某个目标网络的通路。</p>
<p>而在利用翻译技术将IPv6与IPv4网络进行互联互通时，要改变报文的IP层及传输层的相关信息，这样会对端到端的安全产生影响，导致IPSec的三层安全隧道在翻译设备处出现断点。同时，翻译设备作为网络互通的关键节点，会成为DDoS攻击的主要目标。</p>
<p>总之，安全隐患的主要根源是网络协议设计的缺陷和网络设备开发的bug，或者是网络协议的部署与使用出现问题。在IPv6商用之初，我们应利用IPv6协议提供的新安全特性，先解决部分类似IPv4下已有的威胁。随着IPv6网络的扩大以及各种应用的迁移和增多，我们需要更多关注新型攻击。</p>
<h2 id="IPv6的安全机制和策略"><a href="#IPv6的安全机制和策略" class="headerlink" title="IPv6的安全机制和策略"></a>IPv6的安全机制和策略</h2><blockquote>
<p>在IPv6/IPv4共存时期，过渡技术的安全部署尤为重要。各种网络安全设备都要具备对IPv6和IPv4威胁的防护能力。我们在使用隧道技术时，要尽可能采用静态配置隧道，以降低动态隧道的伪造和非法接入威胁。</p>
</blockquote>
<h3 id="充分利用地址自身的安全特性"><a href="#充分利用地址自身的安全特性" class="headerlink" title="充分利用地址自身的安全特性"></a>充分利用地址自身的安全特性</h3><p>在合适的场景下，使用密码生成地址有助于发现针对ND（Neighbor Discovery，邻居发现）协议和DHCPv6（Dynamic Host Configuration Protocol for IPv6，IPv6动态主机配置协议）协议的欺骗和伪造等问题。由于拥有自身的公私钥对，密码生成地址还可用于IPSec的协商，在某些场景下可以简化协商过程，提高IPSec的性能。</p>
<p>另一种关于地址的安全机制是隐私扩展。由于IPv6网络不需要地址转换，因此没有NAT（Network Address Translation，网络地址转换）设备，这样一来就会将内网的结构及相关信息暴露。所以，内网的网络设备要依靠隐私扩展机制，通过周期性的地址改变，防止内部网络信息的泄露。</p>
<h3 id="设定精细的过滤策略"><a href="#设定精细的过滤策略" class="headerlink" title="设定精细的过滤策略"></a>设定精细的过滤策略</h3><p>面对IPv6地址结构以及相关协议的改变，防火墙或者网络边界设备需要设定更加精细的过滤规则。防火墙需要拒绝对内网知名多播地址访问的报文，关闭不必要的服务端口，过滤内网使用的地址。在对ICMP报文的处理上，由于IPv6对ICMPv6的依赖程度远远超过了IPv4，ICMPv6除了完成ping及错误消息外，还新增了地址分配、地址解析、多播管理和移动IPv6下的使用等功能，因此ICMPv6报文的过滤策略需要根据实际情况小心设置，避免影响正常的服务和应用。</p>
<p>为了防护IPv6扩展头的隐患，防火墙需检查扩展头的合法性。对于分片报文，防火墙能拒绝发送到网络中间设备的分片，并支持重组，具备防DDoS攻击能力。防火墙能识别type 0类型的路由扩展头报文，对其进行过滤。入口过滤机制在防火墙和边界设备上的实现也是必要的，以缓解网络间的源地址伪造威胁。</p>
<h3 id="合理的部署策略"><a href="#合理的部署策略" class="headerlink" title="合理的部署策略"></a>合理的部署策略</h3><p>在IPv6/IPv4共存时期，过渡技术的安全部署尤为重要。各种网络安全设备都要具备对IPv6和IPv4威胁的防护能力。我们在使用隧道技术时，要尽可能采用静态配置隧道，以降低动态隧道的伪造和非法接入威胁。防火墙要设置对非授权隧道报文的过滤，同时识别各种隧道协议，能够对隧道报文的内嵌封装报文做访问控制。翻译设备则要做好自身的DDoS攻击防范。</p>
<p>2010年是IPv6的商用元年，各大运营商纷纷制定过渡方案，宣布演进计划，开启试点城市。华为的安全产品已经为IPv6商用做好了充分准备，2009年通过了IPv6 Ready认证。值得一提的是，华为IPv6防火墙在国内首家通过IPv6 Ready第二阶段增强认证，而且能将当前多种主流的过渡技术与方案集成于同一设备，满足了当前IPv6商用的市场需求。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://www.huawei.com/ilink/en/download/HW_079734" target="_blank" rel="noopener">IPv6安全浅析 - Huawei - 2010.12 第52期</a> </li>
<li><a href="http://iot.10086.cn:81/Uploads/file/news/20181205/20181205173726_92618.pdf" target="_blank" rel="noopener">IPv6安全白皮书 - 中移物联网 - 中国移动</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
      
      
      
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/IPv6/">IPv6</a></li></ul>

      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-HTTPS原理与证书"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/10/30/HTTPS原理与证书/">HTTPS原理与证书生成</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/10/30/HTTPS原理与证书/" class="article-date">
	  <time datetime="2018-10-30T03:08:00.000Z" itemprop="datePublished">2018-10-30</time>
	</a>

      
    <a class="article-category-link" href="categories/Web/">Web</a>

      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>HTTPS与HTTP是什么关系呢？我们可以对比下HTTP与HTTPS的请求过程：</p>
<p><img src="/gallery/common/http-state.png" alt="HTTP请求过程"></p>
<p>HTTPS 在 TCP 和 HTTP 之间增加了 TLS（Transport Layer Security，传输层安全），提供了<strong>内容加密</strong>、<strong>身份认证</strong>和<strong>数据完整性</strong>三大功能。</p>
<p><img src="/gallery/common/https-state.png" alt="HTTPS请求过程"></p>
      
    </div>
    <footer class="article-footer">
      
      
      
      
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/HTTPS/">HTTPS</a></li></ul>

      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-WebSocket协议浅析"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/10/27/WebSocket协议浅析/">WebSocket协议浅析</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/10/27/WebSocket协议浅析/" class="article-date">
	  <time datetime="2018-10-27T03:08:00.000Z" itemprop="datePublished">2018-10-27</time>
	</a>

      
    <a class="article-category-link" href="categories/Web/">Web</a>

      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="HTTP协议的缺点"><a href="#HTTP协议的缺点" class="headerlink" title="HTTP协议的缺点"></a>HTTP协议的缺点</h2><p><img src="/gallery/common/http-protocol-drawback.jpg" alt="HTTP协议的缺点"></p>
<ol>
<li>单向请求：只能是客户端发起，服务端处理并响应</li>
<li>请求/响应模式</li>
<li>无状态协议</li>
<li>半双工协议</li>
</ol>
<p>半双工数据传输指数据可以在一个信号载体的两个方向上传输，但是不能同时传输。HTTP协议这种单向请求的特点，注定了如果服务器有连续的状态变化，客户端要获知就非常麻烦。我们只能使用轮询：每隔一段时候，就发出一个询问，了解服务器有没有新的信息。轮询的效率低，非常浪费资源。WebSocket就可以解决这些问题。</p>
      
    </div>
    <footer class="article-footer">
      
      
      
      
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/WebSocket/">WebSocket</a></li></ul>

      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-CPU Cache与缓存行"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/09/09/CPU Cache与缓存行/">CPU Cache与缓存行</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/09/09/CPU Cache与缓存行/" class="article-date">
	  <time datetime="2018-09-09T14:20:55.000Z" itemprop="datePublished">2018-09-09</time>
	</a>

      
    <a class="article-category-link" href="categories/Java/">Java</a>

      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>先看下面这两个循环遍历哪个快？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[][] array = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">64</span> * <span class="number">1024</span>][<span class="number">1024</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 横向遍历</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span> * <span class="number">1024</span>; i ++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">1024</span>; j ++)</span><br><span class="line">        array[i][j] ++;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 纵向遍历</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1024</span>; i ++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">64</span> * <span class="number">1024</span>; j ++)</span><br><span class="line">        array[j][i] ++;</span><br></pre></td></tr></table></figure>
<p>在CPU处理器参数为 2.3 GHz Intel Core i5 的Mac上的结果是：</p>
<blockquote>
<p>横向遍历:    80ms<br>纵向遍历:    2139ms</p>
</blockquote>
<p>横向遍历的 CPU cache 命中率高，所以它比纵向遍历约快这么多倍！</p>
<p><a href="http://igoro.com/archive/gallery-of-processor-cache-effects/" target="_blank" rel="noopener">Gallery of Processor Cache Effects</a> 用 7 个源码示例生动的介绍 cache 原理，深入浅出！但是可能因操作系统的差异、编译器是否优化，以及近些年 cache 性能的提升，有些样例在 Mac 的效果与原文相差较大。</p>
      
    </div>
    <footer class="article-footer">
      
      
      
      
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Java/">Java</a></li></ul>

      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-【Java】J.U.C并发包 - AQS机制"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/07/19/【Java】J.U.C并发包 - AQS机制/">【Java】J.U.C并发包 - AQS机制</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/07/19/【Java】J.U.C并发包 - AQS机制/" class="article-date">
	  <time datetime="2018-07-19T14:20:55.000Z" itemprop="datePublished">2018-07-19</time>
	</a>

      
    <a class="article-category-link" href="categories/Java/">Java</a><a class="article-category-link" href="categories/Java/源码分析/">源码分析</a>

      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Java并发包（java.util.concurrent）中提供了很多并发工具，这其中，很多我们耳熟能详的并发工具，譬如ReentrantLock、Semaphore，CountDownLatch，CyclicBarrier，它们的实现都用到了一个共同的基类 - <strong>AbstractQueuedSynchronizer</strong>，简称AQS。AQS提供了一种原子式管理同步状态、阻塞和唤醒线程功能以及队列模型的简单框架。是一个用来构建锁和同步器的框架，使用AQS能简单且高效地构造出应用广泛的大量的同步器，比如我们提到的ReentrantLock，Semaphore，其他的诸如ReentrantReadWriteLock，SynchronousQueue，FutureTask等等皆是基于AQS的。</p>
<h2 id="设计思想"><a href="#设计思想" class="headerlink" title="设计思想"></a>设计思想</h2><p>同步器背后的基本思想非常简单，可以参考AQS作者 Doug Lea 的论文：<a href="http://gee.cs.oswego.edu/dl/papers/aqs.pdf" target="_blank" rel="noopener">The java.util.concurrent Synchronizer Framework</a>。同步器一般包含两种方法，一种是acquire，另一种是release。</p>
<ul>
<li>acquire操作阻塞调用的线程，直到同步状态允许其继续执行。</li>
<li>release操作则是改变同步状态，使得一或多个被acquire阻塞的线程继续执行。</li>
</ul>
<p>其中acquire操作伪代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (synchronization state does not allow acquire) &#123;</span><br><span class="line">	enqueue current thread <span class="keyword">if</span> not already queued;</span><br><span class="line">	possibly block current thread;</span><br><span class="line">&#125;</span><br><span class="line">dequeue current thread <span class="keyword">if</span> it was queued;</span><br></pre></td></tr></table></figure>
<p>release操作伪代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update synchronization state;</span><br><span class="line"><span class="keyword">if</span> (state may permit a blocked thread to acquire)</span><br><span class="line">	unblock one or more queued threads;</span><br></pre></td></tr></table></figure>
<p>为了实现上述操作，需要下面三个基本组件的相互协作：</p>
<ul>
<li>同步状态的原子性管理；</li>
<li>线程的阻塞与解除阻塞；</li>
<li>队列的管理；</li>
</ul>
<p>AQS框架借助于两个类：<strong>Unsafe</strong>(提供CAS操作) 和 <strong>LockSupport</strong>(提供park/unpark操作)。</p>
<h2 id="1-同步状态的原子性管理"><a href="#1-同步状态的原子性管理" class="headerlink" title="1. 同步状态的原子性管理"></a>1. 同步状态的原子性管理</h2><p>AQS类使用单个<code>int</code>（32位）来保存同步状态，并暴露出<code>getState</code>、<code>setState</code>以及<code>compareAndSet</code>操作来读取和更新这个状态。该整数可以表现任何状态。比如， <code>Semaphore</code> 用它来表现剩余的许可数，<code>ReentrantLock</code> 用它来表现拥有它的线程已经请求了多少次锁；<code>FutureTask</code> 用它来表现任务的状态(尚未开始、运行、完成和取消)。</p>
<p>如JDK的文档中所说，使用AQS来实现一个同步器需要覆盖实现如下几个方法，并且使用<code>getState</code>，<code>setState</code>，<code>compareAndSetState</code>这几个方法来设置或者获取状态。</p>
<ul>
<li><p><code>boolean tryAcquire(int arg)</code> </p>
</li>
<li><p><code>boolean tryRelease(int arg)</code> </p>
</li>
<li><p><code>int tryAcquireShared(int arg)</code> </p>
</li>
<li><p><code>boolean tryReleaseShared(int arg)</code> </p>
</li>
<li><code>boolean isHeldExclusively()</code></li>
</ul>
<p>以上方法不需要全部实现，根据获取的锁的种类可以选择实现不同的方法，支持独占(排他)获取锁的同步器应该实现<code>tryAcquire</code>、 <code>tryRelease</code>、<code>isHeldExclusively</code>而支持共享获取的同步器应该实现<code>tryAcquireShared</code>、<code>tryReleaseShared</code>、<code>isHeldExclusively</code>。下面以 <code>CountDownLatch</code> 举例说明基于AQS实现同步器, <code>CountDownLatch</code> 用同步状态持有当前计数，<code>countDown</code>方法调用 release从而导致计数器递减；当计数器为0时，解除所有线程的等待；<code>await</code>调用acquire，如果计数器为0，<code>acquire</code> 会立即返回，否则阻塞。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://gee.cs.oswego.edu/dl/papers/aqs.pdf" target="_blank" rel="noopener">The java.util.concurrent Synchronizer Framework - AQS框架作者Doug Lea的论文</a></li>
<li><a href="http://ifeve.com/aqs-2/" target="_blank" rel="noopener">The j.u.c Synchronizer Framework翻译(二)设计与实现</a></li>
<li><a href="https://blog.csdn.net/vernonzheng/article/details/8288251" target="_blank" rel="noopener">Java多线程（九）之ReentrantLock与Condition</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
      
      
      
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/源码分析/">源码分析</a></li></ul>

      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-【Android】动态链接库so的加载原理"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/07/03/【Android】动态链接库so的加载原理/">【Android】动态链接库so的加载原理</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/07/03/【Android】动态链接库so的加载原理/" class="article-date">
	  <time datetime="2018-07-03T03:51:55.000Z" itemprop="datePublished">2018-07-03</time>
	</a>

      
    <a class="article-category-link" href="categories/Android/">Android</a>

      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近开发的组件时常出现了运行时加载so库失败问题，每天都会有<code>java.lang.UnsatisfiedLinkError</code>的错误爆出来，而且线上总是偶然复现，很疑惑。所以本文将从AOSP源码简单跟踪Android中的动态链接库so的加载原理，试图找出一丝线索。</p>
<h2 id="加载入口"><a href="#加载入口" class="headerlink" title="加载入口"></a>加载入口</h2><p>首先我们知道在Android(Java)中加载一个动态链接库非常简单。就是我们日常调用的 <code>System.load(Sring filename)</code> 或者<code>System.loadLibrary(String libname)</code>开始。 看过<a href="http://47.98.205.211/2017/05/17/jni/" target="_blank" rel="noopener">《理解JNI技术》</a>的应该知道上述代码执行过程中会调用native层的<code>JNI_OnLoad()</code>方法，一般用于动态注册native方法。</p>
<h2 id="System-loadLibrary"><a href="#System-loadLibrary" class="headerlink" title="# System.loadLibrary"></a># System.loadLibrary</h2><p>[System.java]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadLibrary</span><span class="params">(String libname)</span> </span>&#123;</span><br><span class="line">    Runtime.getRuntime().loadLibrary0(VMStack.getCallingClassLoader(), libname);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此处<code>VMStack.getCallingClassLoader()</code>拿到的是调用者的ClassLoader，一般情况下是<strong>PathClassLoader</strong>。我们进入Runtime类的<code>loadLibrary0()</code>方法看看。</p>
<p>[Runtime.java]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">loadLibrary0</span><span class="params">(ClassLoader loader, String libname)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (libname.indexOf((<span class="keyword">int</span>)File.separatorChar) != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(<span class="string">"Directory separator should not appear in library name: "</span> + libname);</span><br><span class="line">    &#125;</span><br><span class="line">    String libraryName = libname;</span><br><span class="line">    <span class="comment">// 1. 如果classloder存在，通过loader.findLibrary()查找到so路径</span></span><br><span class="line">    <span class="keyword">if</span> (loader != <span class="keyword">null</span>) &#123;</span><br><span class="line">        String filename = loader.findLibrary(libraryName);</span><br><span class="line">        <span class="keyword">if</span> (filename == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// It's not necessarily true that the ClassLoader used</span></span><br><span class="line">            <span class="comment">// System.mapLibraryName, but the default setup does, and it's</span></span><br><span class="line">            <span class="comment">// misleading to say we didn't find "libMyLibrary.so" when we</span></span><br><span class="line">            <span class="comment">// actually searched for "liblibMyLibrary.so.so".</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(loader + <span class="string">" couldn't find \""</span> +</span><br><span class="line">                                           System.mapLibraryName(libraryName) + <span class="string">"\""</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String error = doLoad(filename, loader);</span><br><span class="line">        <span class="keyword">if</span> (error != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(error);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 如果classloder不存在，通过loader.findLibrary()查找到so路径</span></span><br><span class="line">    String filename = System.mapLibraryName(libraryName);</span><br><span class="line">    List&lt;String&gt; candidates = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    String lastError = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (String directory : getLibPaths()) &#123;	<span class="comment">// getLibPaths()代码在最下方</span></span><br><span class="line">        String candidate = directory + filename;</span><br><span class="line">        candidates.add(candidate);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (IoUtils.canOpenReadOnly(candidate)) &#123;</span><br><span class="line">            String error = doLoad(candidate, loader);</span><br><span class="line">            <span class="keyword">if</span> (error == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>; <span class="comment">// We successfully loaded the library. Job done.</span></span><br><span class="line">            &#125;</span><br><span class="line">            lastError = error;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 都没找到，抛出 UnsatisfiedLinkError 异常</span></span><br><span class="line">    <span class="keyword">if</span> (lastError != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(lastError);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(<span class="string">"Library "</span> + libraryName + <span class="string">" not found; tried "</span> + candidates);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      
      
      
      
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Android/">Android</a></li></ul>

      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-【Java】使用Atomic实现锁"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/05/22/【Java】使用Atomic实现锁/">【Java】使用Atomic变量实现锁</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/05/22/【Java】使用Atomic实现锁/" class="article-date">
	  <time datetime="2018-05-22T14:20:55.000Z" itemprop="datePublished">2018-05-22</time>
	</a>

      
    <a class="article-category-link" href="categories/Java/">Java</a>

      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Atomic原子操作"><a href="#Atomic原子操作" class="headerlink" title="Atomic原子操作"></a>Atomic原子操作</h2><p>Java从JDK1.5开始提供了java.util.concurrent.atomic包，方便程序员在多线程环境下，无锁的进行原子操作。原子变量的底层使用了处理器提供的原子指令，但是不同的CPU架构可能提供的原子指令不一样，也有可能需要某种形式的内部锁,所以该方法不能绝对保证线程不被阻塞。</p>
<p>在Atomic包里一共有12个类，四种原子更新方式，分别是原子更新基本类型，原子更新数组，原子更新引用和原子更新字段。Atomic包里的类基本都是使用Unsafe实现的包装类。</p>
<ul>
<li>原子更新基本类型类： AtomicBoolean，AtomicInteger，AtomicLong，AtomicReference</li>
<li>原子更新数组类：AtomicIntegerArray，AtomicLongArray</li>
<li>原子更新引用类型：AtomicMarkableReference，AtomicStampedReference，AtomicReferenceArray</li>
<li>原子更新字段类：AtomicLongFieldUpdater，AtomicIntegerFieldUpdater，AtomicReferenceFieldUpdater</li>
</ul>
<p>详细介绍可以参考：<a href="http://ifeve.com/java-atomic/" target="_blank" rel="noopener">Java中的Atomic包使用指南</a></p>
<h2 id="Atomic的原理"><a href="#Atomic的原理" class="headerlink" title="Atomic的原理"></a>Atomic的原理</h2><p>下面通过<code>AtomicInteger</code>的源码来看一下是怎么在没有锁的情况下保证数据正确性。首先看一下<code>incrementAndGet()</code>方法的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Atomically increments by one the current value.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the updated value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">incrementAndGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> unsafe.getAndAddInt(<span class="keyword">this</span>, valueOffset, <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      
      
      
      
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Java/">Java</a></li></ul>

      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-【Java】NIO的理解"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/05/15/【Java】NIO的理解/">【Java】NIO的原理与浅析</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/05/15/【Java】NIO的理解/" class="article-date">
	  <time datetime="2018-05-15T14:20:55.000Z" itemprop="datePublished">2018-05-15</time>
	</a>

      
    <a class="article-category-link" href="categories/Java/">Java</a>

      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="几个概念"><a href="#几个概念" class="headerlink" title="几个概念"></a>几个概念</h2><h3 id="用户空间与内核空间"><a href="#用户空间与内核空间" class="headerlink" title="用户空间与内核空间"></a>用户空间与内核空间</h3><p>现在操作系统都是采用虚拟存储器，那么对32位操作系统而言，它的寻址空间（虚拟存储空间）为4G（2的32次方）。操作系统的核心是内核，独立于普通的应用程序，可以访问受保护的内存空间，也有访问底层硬件设备的所有权限。为了保证用户进程不能直接操作内核（kernel），保证内核的安全，操心系统将虚拟空间划分为两部分，一部分为内核空间，一部分为用户空间。针对linux操作系统而言，将最高的1G字节（从虚拟地址0xC0000000到0xFFFFFFFF），供内核使用，称为内核空间，而将较低的3G字节（从虚拟地址0x00000000到0xBFFFFFFF），供各个进程使用，称为用户空间。</p>
<p>在Linux世界，进程不能直接访问硬件设备，当进程需要访问硬件设备(比如读取磁盘文件，接收网络数据等等)时，必须由用户态模式切换至内核态模式，通过系统调用访问硬件设备。</p>
<h3 id="文件描述符fd"><a href="#文件描述符fd" class="headerlink" title="文件描述符fd"></a>文件描述符fd</h3><p>文件描述符（File descriptor）是计算机科学中的一个术语，是一个用于表述指向文件的引用的抽象化概念。</p>
<p>文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，一些涉及底层的程序编写往往会围绕着文件描述符展开。但是文件描述符这一概念往往只适用于UNIX、Linux这样的操作系统。</p>
      
    </div>
    <footer class="article-footer">
      
      
      
      
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Java/">Java</a></li></ul>

      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-【Java】Thread类中的join()方法原理"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/05/04/【Java】Thread类中的join()方法原理/">【Java】Thread类中的join()方法原理</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/05/04/【Java】Thread类中的join()方法原理/" class="article-date">
	  <time datetime="2018-05-04T14:20:55.000Z" itemprop="datePublished">2018-05-04</time>
	</a>

      
    <a class="article-category-link" href="categories/Java/">Java</a><a class="article-category-link" href="categories/Java/源码分析/">源码分析</a>

      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>join()</code>是Thread类的一个方法。根据jdk文档的定义：</p>
<blockquote>
<p>public final void join()throws InterruptedException:  <strong>Waits for this thread to die</strong>.</p>
</blockquote>
<p><code>join()</code>方法的作用，是等待这个线程结束；但显然，这样的定义并不清晰。个人认为”Java 7 Concurrency Cookbook”的定义较为清晰：</p>
<blockquote>
<p><strong>join() method suspends the execution of the calling thread until the object called finishes its execution.</strong></p>
</blockquote>
<p>也就是说，t.join()方法阻塞调用此方法的线程(calling thread)，直到线程t完成，此线程再继续；通常用于在main()主线程内，等待其它线程完成再结束main()主线程。我们来看看下面的例子。</p>
      
    </div>
    <footer class="article-footer">
      
      
      
      
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/源码分析/">源码分析</a></li></ul>

      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  
    <article id="post-【Android】Retrofit源码分析"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/04/10/【Android】Retrofit源码分析/">【Android】Retrofit源码分析</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/04/10/【Android】Retrofit源码分析/" class="article-date">
	  <time datetime="2018-04-10T14:20:55.000Z" itemprop="datePublished">2018-04-10</time>
	</a>

      
    <a class="article-category-link" href="categories/Android/">Android</a><a class="article-category-link" href="categories/Android/源码分析/">源码分析</a>

      
      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Retrofit简介"><a href="#Retrofit简介" class="headerlink" title="Retrofit简介"></a>Retrofit简介</h3><p><code>retrofit</code> n. 式样翻新，花样翻新      vt. 给机器设备装配（新部件），翻新，改型</p>
<p><a href="http://square.github.io/retrofit/" target="_blank" rel="noopener"><strong>Retrofit</strong></a> 是一个 RESTful 的 HTTP 网络请求框架的封装。注意这里并没有说它是网络请求框架，主要原因在于网络请求的工作并不是 <code>Retrofit</code> 来完成的。<code>Retrofit</code> 2.0 开始内置 <a href="http://square.github.io/okhttp/" target="_blank" rel="noopener"><code>OkHttp</code></a>，前者专注于接口的封装，后者专注于真正的网络请求。即通过 大量的设计模式 封装了 <code>OkHttp</code> ，使得简洁易用。</p>
<p><img src="/gallery/android_common/4182937778-57515297dacff_articlex.png" alt=""></p>
<p>我们的应用程序通过 <code>Retrofit</code> 请求网络，实际上是使用 <code>Retrofit</code> 接口层封装请求参数、Header、Url 等信息，之后由 <code>OkHttp</code>完成后续的请求操作，在服务端返回数据之后，<code>OkHttp</code> 将原始的结果交给 <code>Retrofit</code>，后者根据用户的需求对结果进行解析的过程。Retrofit的大概原理过程如下：</p>
<ol>
<li><code>Retrofit</code> 将 <code>Http</code>请求 抽象 成 <code>Java</code>接口</li>
<li>在接口里用 注解 描述和配置 网络请求参数</li>
<li>用动态代理 的方式，动态将网络请求接口的注解 解析 成<code>HTTP</code>请求</li>
<li>最后执行<code>HTTP</code>请求</li>
</ol>
<p>这篇文章我将从Retrofit的基本用法出发，按照其使用步骤，一步步的探究Retrofit的实现原理及其源码的设计模式。</p>
<p>Retrofit Github: <a href="https://github.com/square/retrofit">https://github.com/square/retrofit</a></p>
<h3 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h3><p>使用 <code>Retrofit</code> 非常简单，首先需要在 build.gradle 中添加依赖：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.squareup.retrofit2:retrofit:2.4.0'</span></span><br></pre></td></tr></table></figure>
<p>如果需要使用Gson解析器，也需要在build.gradle中添加依赖（后文会详细讲到Retrofit的Converter）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.squareup.retrofit2:converter-gson:2.0.2'</span></span><br></pre></td></tr></table></figure>
<h4 id="1-定义Interface"><a href="#1-定义Interface" class="headerlink" title="1. 定义Interface"></a>1. 定义Interface</h4><p>Retrofit使用java interface和注解描述了HTTP请求的API参数，比如Github的一个API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GitHubService</span> </span>&#123;</span><br><span class="line">  <span class="meta">@GET</span>(<span class="string">"users/&#123;user&#125;/repos"</span>)</span><br><span class="line">  Call&lt;List&lt;Repo&gt;&gt; listRepos(<span class="meta">@Path</span>(<span class="string">"user"</span>) String user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      
      
      
      
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/源码分析/">源码分析</a></li></ul>

      

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="page/2/">2</a><a class="page-number" href="page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="page/12/">12</a><a class="extend next" rel="next" href="page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
      </div>
      
        <div align="center" style="margin-top: 30px;"><hr class="hr" style="margin:0px; height:3px;"></div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2019 iTimeTraveler All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |  
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="index.html" class="mobile-nav-link">Home</a>
  
    <a href="archives" class="mobile-nav-link">Archives</a>
  
    <a href="categories" class="mobile-nav-link">Categories</a>
  
    <a href="tags" class="mobile-nav-link">Tags</a>
  
    <a href="funnysite" class="mobile-nav-link">酷站</a>
  
    <a href="collection" class="mobile-nav-link">收藏</a>
  
    <a href="about" class="mobile-nav-link">About</a>
  
    <a href="/mybooks" class="mobile-nav-link">🎁</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="fancybox/jquery.fancybox.css">
  <script src="fancybox/jquery.fancybox.pack.js"></script>


<script src="js/scripts.js"></script>


  <script src="js/home.js"></script>










	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            iTimeTraveler
          </div>
          <div class="panel-body">
            Copyright © 2019 Mr.Seven All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
</body>
</html>